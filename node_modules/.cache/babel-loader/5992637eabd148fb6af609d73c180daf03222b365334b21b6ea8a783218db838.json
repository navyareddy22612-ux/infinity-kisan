{"ast":null,"code":"export const analyzeDiseaseImages = async (images, crop, symptoms, language = 'en') => {\n  const apiKey = process.env.REACT_APP_GEMINI_API_KEY || localStorage.getItem('gemini_api_key');\n  if (!apiKey) {\n    throw new Error('API Key missing');\n  }\n  const prompt = `\n        As an expert plant pathologist, analyze the following images of a ${crop} plant.\n        Symptoms described by the user: ${symptoms || 'None provided'}.\n        \n        Please provide the analysis in the following JSON format:\n        {\n            \"disease\": \"Name of the disease\",\n            \"confidence\": \"High/Medium/Low\",\n            \"symptoms\": [\"List of observed symptoms\"],\n            \"treatments\": [\"Recommended organic and chemical treatments\"],\n            \"preventiveMeasures\": [\"Steps to prevent future occurrences\"]\n        }\n        \n        Return only the JSON.\n    `;\n  try {\n    const imageParts = images.map(img => {\n      // Remove data:image/jpeg;base64, prefix\n      const base64Data = img.split(',')[1];\n      const mimeType = img.split(',')[0].split(':')[1].split(';')[0];\n      return {\n        inlineData: {\n          data: base64Data,\n          mimeType: mimeType\n        }\n      };\n    });\n    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        contents: [{\n          parts: [{\n            text: prompt\n          }, ...imageParts]\n        }]\n      })\n    });\n    if (!response.ok) {\n      var _errorData$error;\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(((_errorData$error = errorData.error) === null || _errorData$error === void 0 ? void 0 : _errorData$error.message) || `API request failed with status ${response.status}`);\n    }\n    const data = await response.json();\n    if (data.error) {\n      throw new Error(data.error.message);\n    }\n    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {\n      throw new Error('No analysis result was returned by the AI.');\n    }\n    const text = data.candidates[0].content.parts[0].text;\n    // Basic JSON extraction in case the model returns markdown code blocks\n    const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n    const result = JSON.parse(jsonMatch ? jsonMatch[0] : text);\n    return result;\n  } catch (error) {\n    console.error('Gemini Analysis Error:', error);\n    throw error;\n  }\n};","map":{"version":3,"names":["analyzeDiseaseImages","images","crop","symptoms","language","apiKey","process","env","REACT_APP_GEMINI_API_KEY","localStorage","getItem","Error","prompt","imageParts","map","img","base64Data","split","mimeType","inlineData","data","response","fetch","method","headers","body","JSON","stringify","contents","parts","text","ok","_errorData$error","errorData","json","catch","error","message","status","candidates","content","jsonMatch","match","result","parse","console"],"sources":["C:/Users/navya/Desktop/hackathon/src/services/gemini.js"],"sourcesContent":["\r\nexport const analyzeDiseaseImages = async (images, crop, symptoms, language = 'en') => {\r\n    const apiKey = process.env.REACT_APP_GEMINI_API_KEY || localStorage.getItem('gemini_api_key');\r\n\r\n    if (!apiKey) {\r\n        throw new Error('API Key missing');\r\n    }\r\n\r\n    const prompt = `\r\n        As an expert plant pathologist, analyze the following images of a ${crop} plant.\r\n        Symptoms described by the user: ${symptoms || 'None provided'}.\r\n        \r\n        Please provide the analysis in the following JSON format:\r\n        {\r\n            \"disease\": \"Name of the disease\",\r\n            \"confidence\": \"High/Medium/Low\",\r\n            \"symptoms\": [\"List of observed symptoms\"],\r\n            \"treatments\": [\"Recommended organic and chemical treatments\"],\r\n            \"preventiveMeasures\": [\"Steps to prevent future occurrences\"]\r\n        }\r\n        \r\n        Return only the JSON.\r\n    `;\r\n\r\n    try {\r\n        const imageParts = images.map(img => {\r\n            // Remove data:image/jpeg;base64, prefix\r\n            const base64Data = img.split(',')[1];\r\n            const mimeType = img.split(',')[0].split(':')[1].split(';')[0];\r\n            return {\r\n                inlineData: {\r\n                    data: base64Data,\r\n                    mimeType: mimeType\r\n                }\r\n            };\r\n        });\r\n\r\n        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({\r\n                contents: [{\r\n                    parts: [\r\n                        { text: prompt },\r\n                        ...imageParts\r\n                    ]\r\n                }]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json().catch(() => ({}));\r\n            throw new Error(errorData.error?.message || `API request failed with status ${response.status}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.error) {\r\n            throw new Error(data.error.message);\r\n        }\r\n\r\n        if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {\r\n            throw new Error('No analysis result was returned by the AI.');\r\n        }\r\n\r\n        const text = data.candidates[0].content.parts[0].text;\r\n        // Basic JSON extraction in case the model returns markdown code blocks\r\n        const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\r\n        const result = JSON.parse(jsonMatch ? jsonMatch[0] : text);\r\n\r\n        return result;\r\n    } catch (error) {\r\n        console.error('Gemini Analysis Error:', error);\r\n        throw error;\r\n    }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}