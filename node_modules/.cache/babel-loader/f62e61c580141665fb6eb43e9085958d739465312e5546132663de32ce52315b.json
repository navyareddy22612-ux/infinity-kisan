{"ast":null,"code":"export const analyzeDiseaseImages = async (images, crop, symptoms, language = 'en') => {\n  // Hardcoding as a fallback to ensure it works even if .env is not picked up\n  const apiKey = 'AIzaSyArwjyiNOVSQvX-jC4XXbjDq4LEWkEQ5wI';\n  const prompt = `\n        Identify the disease in this ${crop} plant.\n        User symptoms: ${symptoms || 'None'}.\n        Provide a JSON response with these keys: disease, confidence, symptoms (array), treatments (array), preventiveMeasures (array).\n        Reply ONLY with valid JSON.\n    `;\n  try {\n    const imageParts = images.map(img => {\n      // Remove data:image/jpeg;base64, prefix\n      const base64Data = img.split(',')[1];\n      const mimeType = img.split(',')[0].split(':')[1].split(';')[0];\n      return {\n        inline_data: {\n          data: base64Data,\n          mime_type: mimeType\n        }\n      };\n    });\n    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        contents: [{\n          parts: [{\n            text: prompt\n          }, ...imageParts]\n        }]\n      })\n    });\n    if (!response.ok) {\n      var _errorData$error;\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(((_errorData$error = errorData.error) === null || _errorData$error === void 0 ? void 0 : _errorData$error.message) || `API request failed with status ${response.status}`);\n    }\n    const data = await response.json();\n    if (data.error) {\n      throw new Error(data.error.message);\n    }\n    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {\n      throw new Error('No analysis result was returned by the AI.');\n    }\n    const text = data.candidates[0].content.parts[0].text;\n    // Basic JSON extraction in case the model returns markdown code blocks\n    const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n    const result = JSON.parse(jsonMatch ? jsonMatch[0] : text);\n    return result;\n  } catch (error) {\n    console.error('Gemini Analysis Error:', error);\n    throw error;\n  }\n};","map":{"version":3,"names":["analyzeDiseaseImages","images","crop","symptoms","language","apiKey","prompt","imageParts","map","img","base64Data","split","mimeType","inline_data","data","mime_type","response","fetch","method","headers","body","JSON","stringify","contents","parts","text","ok","_errorData$error","errorData","json","catch","Error","error","message","status","candidates","content","jsonMatch","match","result","parse","console"],"sources":["C:/Users/navya/Desktop/hackathon/src/services/gemini.js"],"sourcesContent":["\r\nexport const analyzeDiseaseImages = async (images, crop, symptoms, language = 'en') => {\r\n    // Hardcoding as a fallback to ensure it works even if .env is not picked up\r\n    const apiKey = 'AIzaSyArwjyiNOVSQvX-jC4XXbjDq4LEWkEQ5wI';\r\n\r\n    const prompt = `\r\n        Identify the disease in this ${crop} plant.\r\n        User symptoms: ${symptoms || 'None'}.\r\n        Provide a JSON response with these keys: disease, confidence, symptoms (array), treatments (array), preventiveMeasures (array).\r\n        Reply ONLY with valid JSON.\r\n    `;\r\n\r\n    try {\r\n        const imageParts = images.map(img => {\r\n            // Remove data:image/jpeg;base64, prefix\r\n            const base64Data = img.split(',')[1];\r\n            const mimeType = img.split(',')[0].split(':')[1].split(';')[0];\r\n            return {\r\n                inline_data: {\r\n                    data: base64Data,\r\n                    mime_type: mimeType\r\n                }\r\n            };\r\n        });\r\n\r\n        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({\r\n                contents: [{\r\n                    parts: [\r\n                        { text: prompt },\r\n                        ...imageParts\r\n                    ]\r\n                }]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json().catch(() => ({}));\r\n            throw new Error(errorData.error?.message || `API request failed with status ${response.status}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.error) {\r\n            throw new Error(data.error.message);\r\n        }\r\n\r\n        if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {\r\n            throw new Error('No analysis result was returned by the AI.');\r\n        }\r\n\r\n        const text = data.candidates[0].content.parts[0].text;\r\n        // Basic JSON extraction in case the model returns markdown code blocks\r\n        const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\r\n        const result = JSON.parse(jsonMatch ? jsonMatch[0] : text);\r\n\r\n        return result;\r\n    } catch (error) {\r\n        console.error('Gemini Analysis Error:', error);\r\n        throw error;\r\n    }\r\n};\r\n"],"mappings":"AACA,OAAO,MAAMA,oBAAoB,GAAG,MAAAA,CAAOC,MAAM,EAAEC,IAAI,EAAEC,QAAQ,EAAEC,QAAQ,GAAG,IAAI,KAAK;EACnF;EACA,MAAMC,MAAM,GAAG,yCAAyC;EAExD,MAAMC,MAAM,GAAG;AACnB,uCAAuCJ,IAAI;AAC3C,yBAAyBC,QAAQ,IAAI,MAAM;AAC3C;AACA;AACA,KAAK;EAED,IAAI;IACA,MAAMI,UAAU,GAAGN,MAAM,CAACO,GAAG,CAACC,GAAG,IAAI;MACjC;MACA,MAAMC,UAAU,GAAGD,GAAG,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;MACpC,MAAMC,QAAQ,GAAGH,GAAG,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAACA,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAACA,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;MAC9D,OAAO;QACHE,WAAW,EAAE;UACTC,IAAI,EAAEJ,UAAU;UAChBK,SAAS,EAAEH;QACf;MACJ,CAAC;IACL,CAAC,CAAC;IAEF,MAAMI,QAAQ,GAAG,MAAMC,KAAK,CAAC,gGAAgGZ,MAAM,EAAE,EAAE;MACnIa,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACL,cAAc,EAAE;MACpB,CAAC;MACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QACjBC,QAAQ,EAAE,CAAC;UACPC,KAAK,EAAE,CACH;YAAEC,IAAI,EAAEnB;UAAO,CAAC,EAChB,GAAGC,UAAU;QAErB,CAAC;MACL,CAAC;IACL,CAAC,CAAC;IAEF,IAAI,CAACS,QAAQ,CAACU,EAAE,EAAE;MAAA,IAAAC,gBAAA;MACd,MAAMC,SAAS,GAAG,MAAMZ,QAAQ,CAACa,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;MACzD,MAAM,IAAIC,KAAK,CAAC,EAAAJ,gBAAA,GAAAC,SAAS,CAACI,KAAK,cAAAL,gBAAA,uBAAfA,gBAAA,CAAiBM,OAAO,KAAI,kCAAkCjB,QAAQ,CAACkB,MAAM,EAAE,CAAC;IACpG;IAEA,MAAMpB,IAAI,GAAG,MAAME,QAAQ,CAACa,IAAI,CAAC,CAAC;IAElC,IAAIf,IAAI,CAACkB,KAAK,EAAE;MACZ,MAAM,IAAID,KAAK,CAACjB,IAAI,CAACkB,KAAK,CAACC,OAAO,CAAC;IACvC;IAEA,IAAI,CAACnB,IAAI,CAACqB,UAAU,IAAI,CAACrB,IAAI,CAACqB,UAAU,CAAC,CAAC,CAAC,IAAI,CAACrB,IAAI,CAACqB,UAAU,CAAC,CAAC,CAAC,CAACC,OAAO,EAAE;MACxE,MAAM,IAAIL,KAAK,CAAC,4CAA4C,CAAC;IACjE;IAEA,MAAMN,IAAI,GAAGX,IAAI,CAACqB,UAAU,CAAC,CAAC,CAAC,CAACC,OAAO,CAACZ,KAAK,CAAC,CAAC,CAAC,CAACC,IAAI;IACrD;IACA,MAAMY,SAAS,GAAGZ,IAAI,CAACa,KAAK,CAAC,aAAa,CAAC;IAC3C,MAAMC,MAAM,GAAGlB,IAAI,CAACmB,KAAK,CAACH,SAAS,GAAGA,SAAS,CAAC,CAAC,CAAC,GAAGZ,IAAI,CAAC;IAE1D,OAAOc,MAAM;EACjB,CAAC,CAAC,OAAOP,KAAK,EAAE;IACZS,OAAO,CAACT,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;IAC9C,MAAMA,KAAK;EACf;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}